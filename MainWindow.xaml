<Window
    x:Class="VivaldiUpdater.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:local="clr-namespace:VivaldiUpdater"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:properties="clr-namespace:VivaldiUpdater.Properties"
    Title="MainWindow"
    Width="525"
    Height="500"
    AllowsTransparency="True"
    Background="Transparent"
    Loaded="MainWindow_OnLoaded"
    WindowStartupLocation="CenterScreen"
    WindowStyle="None"
    mc:Ignorable="d">
    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="tinyStyle.xaml" />
            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>
    </Window.Resources>
    <Border Background="#EFD6F3" CornerRadius="20">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="30" />
                <RowDefinition />
            </Grid.RowDefinitions>
            <Grid MouseLeftButtonDown="HandleDrag">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <Grid x:Name="windowsHeader" Background="Transparent">
                    <TextBlock
                        Margin="5"
                        HorizontalAlignment="Left"
                        VerticalAlignment="Center"
                        FontSize="15"
                        Foreground="Gray"
                        Text="Vivaldi Updater by czyt" />
                    <TextBlock
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        Text="{Binding AppVersion, StringFormat=v{0}}">
                        <TextBlock.Effect>
                            <DropShadowEffect
                                BlurRadius="1"
                                Direction="30"
                                Opacity="0.5"
                                ShadowDepth="2"
                                Color="OrangeRed" />
                        </TextBlock.Effect>
                    </TextBlock>
                    <!-- Update Icon in Header -->
                    <Button
                        Width="20"
                        Height="20"
                        Margin="120,0,0,0"
                        Padding="0"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        Background="Transparent"
                        BorderThickness="0"
                        Command="{Binding ManualUpdateAppCommand}"
                        Cursor="Hand"
                        ToolTip="{Binding LocalizedNewVersionFoundLabel}">
                         <Button.Style>
                            <Style TargetType="Button" BasedOn="{StaticResource AppleButtonStyle}">
                                <Setter Property="Visibility" Value="Collapsed"/>
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding IsAppUpdateAvailable}" Value="True">
                                        <Setter Property="Visibility" Value="Visible"/>
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Button.Style>
                        <Path Data="{StaticResource UpdateIconGeometry}" Fill="#FF5722" Width="14" Height="14" Stretch="Uniform" VerticalAlignment="Center"/>
                    </Button>
                    <!--  Proxy Settings Button in Header  -->
                    <Button
                        Width="20"
                        Height="20"
                        Margin="0,0,100,0"
                        Padding="2"
                        HorizontalAlignment="Right"
                        VerticalAlignment="Center"
                        Background="#F5798B"
                        BorderThickness="0"
                        Command="{Binding ConfigureProxyCommand}"
                        ToolTip="代理设置 / Proxy Settings">
                        <Button.Template>
                            <ControlTemplate TargetType="Button">
                                <Grid>
                                    <Ellipse Fill="{TemplateBinding Background}" />
                                    <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                                </Grid>
                                <ControlTemplate.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter Property="Background" Value="#FF69B4" />
                                    </Trigger>
                                    <Trigger Property="IsPressed" Value="True">
                                        <Setter Property="Background" Value="#FF1493" />
                                    </Trigger>
                                </ControlTemplate.Triggers>
                            </ControlTemplate>
                        </Button.Template>
                        <Viewbox
                            Width="12"
                            Height="12"
                            Margin="1">
                            <Canvas Width="1024" Height="1024">
                                <Path Data="M846.250667 835.328a431.701333 431.701333 0 0 0-94.549334-61.44l1.877334-5.717333c11.093333-35.413333 20.138667-73.386667 26.453333-113.493334 0.853333-5.034667 1.450667-10.154667 2.133333-15.274666 2.133333-15.189333 3.925333-30.72 5.290667-46.506667l1.450667-17.578667c0.853333-13.141333 1.109333-26.624 1.536-40.106666h186.026666A464.128 464.128 0 0 1 846.250667 835.413333zM650.154667 956.586667c9.984-10.496 19.626667-22.186667 28.757333-34.816l2.56-3.584c18.517333-25.856 35.157333-55.722667 49.493333-89.173334 0.853333-1.706667 1.536-3.669333 2.304-5.461333 0.853333-1.962667 1.536-4.266667 2.304-6.229333 28.757333 13.994667 54.528 30.805333 77.056 49.493333A463.36 463.36 0 0 1 650.24 956.586667z m-114.858667 18.517333V769.024a522.24 522.24 0 0 1 159.317333 30.72c-37.973333 96.682667-94.72 162.56-159.317333 175.36z m0-439.808H744.106667a824.661333 824.661333 0 0 1-34.474667 220.757333 564.992 564.992 0 0 0-174.421333-33.536V535.296z m0-233.813333a564.992 564.992 0 0 0 174.421333-33.536c19.968 64.853333 32.426667 139.946667 34.474667 220.757333H535.296V301.482667z m0-252.586667c64.597333 12.8 121.344 78.677333 159.317333 175.36a521.472 521.472 0 0 1-159.317333 30.72V48.896z m277.333333 108.202667c-22.528 18.773333-48.298667 35.584-77.056 49.664-0.853333-2.048-1.450667-4.266667-2.304-6.229334l-2.218666-5.546666a484.778667 484.778667 0 0 0-49.493334-89.173334l-2.56-3.584A344.32 344.32 0 0 0 650.069333 67.413333c60.416 18.773333 115.456 49.749333 162.474667 89.685334z m163.84 331.605333h-186.026666c-0.426667-13.397333-0.597333-26.794667-1.536-39.936l-1.450667-17.664a886.698667 886.698667 0 0 0-5.290667-46.506667c-0.682667-5.12-1.28-10.24-2.133333-15.36a785.92 785.92 0 0 0-26.453333-113.408l-1.877334-5.717333c35.413333-16.981333 66.986667-37.802667 94.549334-61.44a463.957333 463.957333 0 0 1 130.218666 300.032zM488.704 254.976a521.557333 521.557333 0 0 1-159.402667-30.72C367.36 127.573333 424.106667 61.781333 488.704 48.896v206.08z m0 233.813333H279.893333c2.048-80.810667 14.506667-155.989333 34.474667-220.842666 52.906667 19.626667 111.957333 31.146667 174.421333 33.536v187.221333z m0 233.728a564.992 564.992 0 0 0-174.421333 33.536 823.722667 823.722667 0 0 1-34.474667-220.757333h208.896v187.221333z m0 252.586667c-64.597333-12.8-121.344-78.677333-159.402667-175.36a522.24 522.24 0 0 1 159.402667-30.72v206.08z m-277.333333-108.202667c22.528-18.773333 48.213333-35.584 76.970666-49.578666 0.853333 1.962667 1.536 4.266667 2.389334 6.229333l2.218666 5.461333c14.506667 33.450667 31.061333 63.317333 49.493334 89.173334l2.56 3.584c9.216 12.629333 18.773333 24.32 28.842666 34.816a463.189333 463.189333 0 0 1-162.474666-89.685334zM47.530667 535.296h186.026666c0.426667 13.397333 0.597333 26.88 1.536 40.021333 0.341333 5.973333 0.938667 11.776 1.450667 17.578667 1.365333 15.786667 3.157333 31.317333 5.290667 46.506667 0.682667 5.12 1.28 10.24 2.133333 15.36 6.314667 40.106667 15.274667 77.994667 26.453333 113.408l1.877334 5.717333a431.786667 431.786667 0 0 0-94.549334 61.44A464.128 464.128 0 0 1 47.530667 535.296z m130.218666-346.538667c27.477333 23.552 59.136 44.373333 94.549334 61.44l-1.877334 5.632a785.92 785.92 0 0 0-26.453333 113.493334c-0.853333 5.034667-1.450667 10.24-2.133333 15.36-2.133333 15.189333-3.925333 30.72-5.290667 46.421333-0.512 5.888-1.109333 11.690667-1.450667 17.664-0.853333 13.141333-1.109333 26.538667-1.536 39.936H47.530667a463.957333 463.957333 0 0 1 130.218666-299.946667zM373.76 67.413333c-9.984 10.496-19.626667 22.186667-28.757333 34.816l-2.56 3.584a484.693333 484.693333 0 0 0-49.493334 89.173334c-0.853333 1.706667-1.536 3.669333-2.304 5.546666-0.853333 1.962667-1.536 4.181333-2.389333 6.229334a381.013333 381.013333 0 0 1-76.970667-49.664A462.762667 462.762667 0 0 1 373.76 67.498667zM512 0a512 512 0 1 0 0 1024A512 512 0 0 0 512 0z" Fill="White" />
                            </Canvas>
                        </Viewbox>
                    </Button>
                </Grid>
                <Grid Grid.Column="1">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="{Binding ElementName=windowsHeader, Path=ActualHeight}" />
                        <ColumnDefinition Width="{Binding ElementName=windowsHeader, Path=ActualHeight}" />
                        <ColumnDefinition Width="{Binding ElementName=windowsHeader, Path=ActualHeight}" />
                        <ColumnDefinition Width="3" />
                    </Grid.ColumnDefinitions>
                    <Button Style="{StaticResource AppleButtonStyle}">
                        <Viewbox>
                            <Ellipse
                                Width="15"
                                Height="15"
                                Fill="#FFDAD404"
                                Stroke="#FFFDFDFD"
                                StrokeThickness="0.5" />
                        </Viewbox>
                    </Button>
                    <Button Grid.Column="1" Style="{StaticResource AppleButtonStyle}">
                        <Viewbox>
                            <Ellipse
                                Width="15"
                                Height="15"
                                Fill="#FF18D018"
                                Stroke="#FFFDFDFD"
                                StrokeThickness="0.5" />
                        </Viewbox>
                    </Button>
                    <Button
                        x:Name="closeButton"
                        Grid.Column="2"
                        Click="CloseButton_OnClick"
                        Style="{StaticResource AppleButtonStyle}">
                        <Viewbox>
                            <Ellipse
                                Width="15"
                                Height="15"
                                Fill="#FFEE7408"
                                Stroke="#FFFDFDFD"
                                StrokeThickness="0.5" />
                        </Viewbox>
                    </Button>
                </Grid>
            </Grid>
            <Grid Grid.Row="1" Margin="15">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="*" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="80" />
                </Grid.RowDefinitions>
                <!--  display info  -->
                <StackPanel>
                    <!--  vivaldi info  -->
                    <StackPanel HorizontalAlignment="Center" Orientation="Horizontal">
                        <TextBlock
                            Width="120"
                            HorizontalAlignment="Left"
                            VerticalAlignment="Center"
                            Foreground="PaleVioletRed"
                            Text="{Binding LocalizedVivaldiBrowserLabel}" />
                        <TextBlock
                            Margin="20,0,0,0"
                            HorizontalAlignment="Left"
                            VerticalAlignment="Center"
                            Foreground="Green"
                            Text="{Binding VivaldiLatestVersion}" />
                        
                         <!-- Update Status -->
                        <Grid Margin="20,0,0,0">
                            <!-- Icon for Update Available -->
                            <Path Data="{StaticResource UpdateIconGeometry}" Fill="#FF5722" Width="16" Height="16" Stretch="Uniform" VerticalAlignment="Center">
                                 <Path.Style>
                                     <Style TargetType="Path">
                                         <Setter Property="Visibility" Value="Collapsed"/>
                                         <Style.Triggers>
                                             <DataTrigger Binding="{Binding IsVivaldiUpdateAvailable}" Value="True">
                                                 <Setter Property="Visibility" Value="Visible"/>
                                             </DataTrigger>
                                         </Style.Triggers>
                                     </Style>
                                 </Path.Style>
                            </Path>
                            <!-- Text for No Update -->
                            <TextBlock
                                HorizontalAlignment="Left"
                                VerticalAlignment="Center"
                                Foreground="BlueViolet"
                                Text="{Binding VivaldiUpdateNotifyText}">
                                 <TextBlock.Style>
                                     <Style TargetType="TextBlock">
                                         <Setter Property="Visibility" Value="Visible"/>
                                         <Style.Triggers>
                                             <DataTrigger Binding="{Binding IsVivaldiUpdateAvailable}" Value="True">
                                                 <Setter Property="Visibility" Value="Collapsed"/>
                                             </DataTrigger>
                                         </Style.Triggers>
                                     </Style>
                                 </TextBlock.Style>
                            </TextBlock>
                        </Grid>
                    </StackPanel>

                    <!--  vivaldi++ info  -->
                    <StackPanel HorizontalAlignment="Center" Orientation="Horizontal">
                        <TextBlock
                            Width="120"
                            Margin="0,10,0,0"
                            HorizontalAlignment="Left"
                            VerticalAlignment="Center"
                            Foreground="PaleVioletRed"
                            Text="{Binding LocalizedVivaldiPlusPluginLabel}" />
                        <TextBlock
                            Margin="20,0,0,0"
                            HorizontalAlignment="Left"
                            VerticalAlignment="Center"
                            Foreground="Green"
                            Text="{Binding VivaldiPlusLatestVersion}" />
                        
                         <!-- Update Status -->
                         <Grid Margin="20,0,0,0">
                            <Path Data="{StaticResource UpdateIconGeometry}" Fill="#FF5722" Width="16" Height="16" Stretch="Uniform" VerticalAlignment="Center">
                                 <Path.Style>
                                     <Style TargetType="Path">
                                         <Setter Property="Visibility" Value="Collapsed"/>
                                         <Style.Triggers>
                                             <DataTrigger Binding="{Binding IsVivaldiPlusUpdateAvailable}" Value="True">
                                                 <Setter Property="Visibility" Value="Visible"/>
                                             </DataTrigger>
                                         </Style.Triggers>
                                     </Style>
                                 </Path.Style>
                            </Path>
                            <TextBlock
                                HorizontalAlignment="Left"
                                VerticalAlignment="Center"
                                Foreground="BlueViolet"
                                Text="{Binding VivaldiPlusUpdateNotifyText}">
                                 <TextBlock.Style>
                                     <Style TargetType="TextBlock">
                                         <Setter Property="Visibility" Value="Visible"/>
                                         <Style.Triggers>
                                             <DataTrigger Binding="{Binding IsVivaldiPlusUpdateAvailable}" Value="True">
                                                 <Setter Property="Visibility" Value="Collapsed"/>
                                             </DataTrigger>
                                         </Style.Triggers>
                                     </Style>
                                 </TextBlock.Style>
                            </TextBlock>
                        </Grid>
                    </StackPanel>
                    


                </StackPanel>
                <!--  Options  -->
                <!--  Options  -->
                <TabControl Grid.Row="1" Margin="10,10,10,0" Style="{StaticResource AppleTabControlStyle}">
                    <TabItem Header="{Binding LocalizedBasicSettingsLabel}">
                        <StackPanel Margin="0,10,0,0">
                            <!--  auto patch with vivaldi++  -->
                            <StackPanel HorizontalAlignment="Center" Orientation="Horizontal">
                                <TextBlock
                                    Width="120"
                                    HorizontalAlignment="Left"
                                    VerticalAlignment="Center"
                                    Foreground="PaleVioletRed"
                                    Text="{Binding LocalizedAutoUpdateVivaldiLabel}" />
                                <ToggleButton
                                    Width="100"
                                    Height="35"
                                    HorizontalAlignment="Left"
                                    VerticalAlignment="Center"
                                    IsChecked="{Binding EnableVivaldiUpdate, Mode=TwoWay}"
                                    Style="{StaticResource AppleToggleButtonStyle}" />
                            </StackPanel>
                            <!--  auto patch with vivaldi++  -->
                            <StackPanel HorizontalAlignment="Center" Orientation="Horizontal">
                                <TextBlock
                                    Width="120"
                                    HorizontalAlignment="Left"
                                    VerticalAlignment="Center"
                                    Foreground="PaleVioletRed"
                                    Text="{Binding LocalizedEnableVivaldiPlusLabel}" />
                                <ToggleButton
                                    Width="100"
                                    Height="35"
                                    HorizontalAlignment="Left"
                                    VerticalAlignment="Center"
                                    IsChecked="{Binding EnableVivaldiPlus, Mode=TwoWay}"
                                    Style="{StaticResource AppleToggleButtonStyle}" />
                            </StackPanel>
                            <!--  update vivaldi++  -->
                            <StackPanel HorizontalAlignment="Center" Orientation="Horizontal">
                                <TextBlock
                                    Width="120"
                                    HorizontalAlignment="Left"
                                    VerticalAlignment="Center"
                                    Foreground="PaleVioletRed"
                                    Text="{Binding LocalizedAutoUpdateVivaldiPlusLabel}" />
                                <ToggleButton
                                    Width="100"
                                    Height="35"
                                    HorizontalAlignment="Left"
                                    VerticalAlignment="Center"
                                    IsChecked="{Binding EnableVivaldiPlusUpdate, Mode=TwoWay}"
                                    Style="{StaticResource AppleToggleButtonStyle}" />
                            </StackPanel>
                            <!--  Enable App Self Update  -->
                            <StackPanel HorizontalAlignment="Center" Orientation="Horizontal">
                                <TextBlock
                                    Width="120"
                                    HorizontalAlignment="Left"
                                    VerticalAlignment="Center"
                                    Foreground="PaleVioletRed"
                                    Text="{Binding LocalizedEnableAppUpdateLabel}" />
                                <ToggleButton
                                    Width="100"
                                    Height="35"
                                    HorizontalAlignment="Left"
                                    VerticalAlignment="Center"
                                    IsChecked="{Binding EnableAppUpdate, Mode=TwoWay}"
                                    Style="{StaticResource AppleToggleButtonStyle}" />
                            </StackPanel>
                            <!--  use mirror address  -->
                            <StackPanel HorizontalAlignment="Center" Orientation="Horizontal">
                                <TextBlock
                                    Width="120"
                                    HorizontalAlignment="Left"
                                    VerticalAlignment="Center"
                                    Foreground="PaleVioletRed"
                                    Text="{Binding LocalizedUseMirrorAddressLabel}" />
                                <ToggleButton
                                    Width="100"
                                    Height="35"
                                    HorizontalAlignment="Left"
                                    VerticalAlignment="Center"
                                    IsChecked="{Binding UseMirrorAddress, Mode=TwoWay}"
                                    Style="{StaticResource AppleToggleButtonStyle}" />
                            </StackPanel>
                            <!--  language selection  -->
                            <StackPanel HorizontalAlignment="Center" Orientation="Horizontal">
                                <TextBlock
                                    Width="120"
                                    HorizontalAlignment="Left"
                                    VerticalAlignment="Center"
                                    Foreground="PaleVioletRed"
                                    Text="{Binding LocalizedLanguageLabel}" />
                                <ComboBox
                                    Width="100"
                                    Height="35"
                                    HorizontalAlignment="Left"
                                    VerticalAlignment="Center"
                                    DisplayMemberPath="DisplayName"
                                    ItemContainerStyle="{StaticResource AppleComboBoxItemStyle}"
                                    ItemsSource="{Binding LanguageOptions}"
                                    SelectedValue="{Binding SelectedLanguage, Mode=TwoWay}"
                                    SelectedValuePath="Tag"
                                    Style="{StaticResource AppleComboBoxStyle}" />
                            </StackPanel>
                        </StackPanel>
                    </TabItem>
                    <TabItem Header="{Binding LocalizedUpdateSettingsLabel}">
                        <StackPanel Margin="0,10,0,0">
                             <!--  Delete Full Installer  -->
                            <StackPanel HorizontalAlignment="Center" Orientation="Horizontal">
                                <TextBlock
                                    Width="220"
                                    HorizontalAlignment="Left"
                                    VerticalAlignment="Center"
                                    Foreground="PaleVioletRed"
                                    Text="{Binding LocalizedDeleteInstallerAfterUpdateLabel}" />
                                <ToggleButton
                                    Width="100"
                                    Height="35"
                                    HorizontalAlignment="Left"
                                    VerticalAlignment="Center"
                                    IsChecked="{Binding DeleteFullInstallerAfterUpdate, Mode=TwoWay}"
                                    Style="{StaticResource AppleToggleButtonStyle}" />
                            </StackPanel>
                             <!--  Clean Backup  -->
                            <StackPanel HorizontalAlignment="Center" Orientation="Horizontal">
                                <TextBlock
                                    Width="220"
                                    HorizontalAlignment="Left"
                                    VerticalAlignment="Center"
                                    Foreground="PaleVioletRed"
                                    Text="{Binding LocalizedCleanBackupAfterUpdateLabel}" />
                                <ToggleButton
                                    Width="100"
                                    Height="35"
                                    HorizontalAlignment="Left"
                                    VerticalAlignment="Center"
                                    IsChecked="{Binding CleanBackupAfterUpdate, Mode=TwoWay}"
                                    Style="{StaticResource AppleToggleButtonStyle}" />
                            </StackPanel>



                        </StackPanel>
                    </TabItem>
                </TabControl>
                <!--  update process  -->
                <StackPanel Grid.Row="2" Margin="0,10,0,0">
                    <ProgressBar
                        Width="200"
                        Height="20"
                        Maximum="100"
                        Style="{StaticResource MacOSProgressBarStyle}"
                        Visibility="{Binding ShowUpdateProcessBar}"
                        Value="{Binding DownloadProgress}" />
                    <TextBlock
                        HorizontalAlignment="Center"
                        Foreground="Sienna"
                        Text="{Binding ProcessBarNotifyText}" />
                </StackPanel>
                <Button
                    Grid.Row="3"
                    Width="200"
                    Height="50"
                    Margin="0,15,0,0"
                    HorizontalAlignment="Center"
                    VerticalAlignment="Top"
                    Command="{Binding ApplyCommand}"
                    Content="{Binding Operation}"
                    Style="{StaticResource ApplePriButtonStyle}" />
            </Grid>
        </Grid>
    </Border>


</Window>
